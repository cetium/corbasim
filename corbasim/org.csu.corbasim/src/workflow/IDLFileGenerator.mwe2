module workflow.IDLFileGenerator

import org.eclipse.emf.mwe.utils.*

var fileEncoding = "UTF-8"
var modelFile = "src/model/Cosnaming.idl"

// Parameters
var targetDir = "src-gen"
var genClient = true
var genServer = true
var genInjector = true
var StubHppSuffix = "\'C.hpp\'"
var StubCppSuffix = "\'C.cpp\'"
var SkelHppSuffix = "\'S.hpp\'"
var SkelCppSuffix = "\'S.cpp\'"
var SkelImplHppSuffix = "\'I.hpp\'"
var SkelImplCppSuffix = "\'I.cpp\'"

Workflow {

	bean = StandaloneSetup {
		registerGeneratedEPackage = "org.csu.idl.idlmm.IdlmmPackage"
		platformUri = "."
	}

	component = org.eclipse.xtext.mwe.UriBasedReader {
		uri = modelFile

		// this class will be generated by the xtext generator 
		register = org.csu.idl.xtext.IDLStandaloneSetup {}
		load = {
			slot = "model"
			type = "TranslationUnit"
		}
	}

	component = org.eclipse.xtend.XtendComponent {
		invoke = "templates::ArrayExpander::expandArrayDefs(model)"
		metaModel = org.eclipse.xtend.type.impl.java.JavaBeansMetaModel {}
	}
	
	component = org.eclipse.xtend.XtendComponent {
		invoke = "templates::ExpressionEvaluator::evaluateExpressions(model)"
		metaModel = org.eclipse.xtend.type.impl.java.JavaBeansMetaModel {}
	}
	
	component = org.eclipse.xtend.XtendComponent {
		invoke = "templates::Include2TranslationUnit::include2TranslationUnit(model)"
		metaModel = org.eclipse.xtend.type.impl.java.JavaBeansMetaModel {}
	}

	component = org.eclipse.xpand2.Generator {
		expand = "templates::corbasim::Main::main FOREACH model"
		metaModel = org.eclipse.xtend.type.impl.java.JavaBeansMetaModel {}
		outlet = {
			path = targetDir
			postprocessor = org.csu.cpp.output.CppBeautifier {}
		}
		fileEncoding = fileEncoding

		// Regiones protegidas
		prSrcPaths = "${targetDir}"
		
		// Variables globales
		globalVarDef = {
			name = "genClient"
			value = "${genClient}"
		}
		globalVarDef = {
			name = "genServer"
			value = "${genServer}"
		}
		globalVarDef = {
			name = "genInjector"
			value = "${genInjector}"
		}
		globalVarDef = {
			name = "StubHppSuffix"
			value = "${StubHppSuffix}"
		}
		globalVarDef = {
			name = "StubCppSuffix"
			value = "${StubCppSuffix}"
		}
		globalVarDef = {
			name = "SkelHppSuffix"
			value = "${SkelHppSuffix}"
		}
		globalVarDef = {
			name = "SkelImplHppSuffix"
			value = "${SkelImplHppSuffix}"
		}
		globalVarDef = {
			name = "SkelCppSuffix"
			value = "${SkelCppSuffix}"
		}
		globalVarDef = {
			name = "SkelImplCppSuffix"
			value = "${SkelImplCppSuffix}"
		}
	}

}
